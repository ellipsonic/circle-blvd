<!-- <button ng-click="test()">Test</button> -->
<!-- <button ng-click="debug()">Debug</button> -->
<!-- <button ng-click="resetStories()">Reset stories</button> -->

<div class="entry-facade col-md-offset-2" ng-hide="isAddingNew">
	<div class="col-md-10 entry-facade-container">
		<div class="backlog-status col-md-1">&nbsp;</div>
		<div class="col-md-9 show-entry">
		+ <a ng-click="showEntry()" class="jsLink">Add story</a>
		</div>

		<div class="col-md-2 alt-mode" 
			ng-class="{alt: isManualAltMode || isAltMode}"
			ng-click="toggleAltMode()" title="inbox mode"><i class="glyphicon glyphicon-align-justify"></i></div>
	</div>
</div>

<div class="entry col-md-offset-2" ng-show="isAddingNew">
	<div class="col-md-10">
		<div class="backlog-status col-md-1">&nbsp;</div>
		<div class="col-md-9">
			<ul class="entry-nav nav nav-pills">
				<li ng-class="{ active: isAdding['story'] }">
					<a class="jsLink" ng-click="showEntry('story')">Story</a>
				</li>
				<li ng-class="{ active: isAdding['deadline'] }">
					<a class="jsLink" ng-click="showEntry('deadline')">Milepost</a>
				</li>
				<li class="pull-right">
					<a ng-click="hideEntry()" class="jsLink subtle">Hide entry</a>
				</li>
			</ul>

			<div ng-show="isAdding['story']" class="new-story">
				<form>
					<div class="input-group">
						<input id="storyEntry" type="text" class="form-control" ng-model="newStory.summary" />
						<span class="input-group-btn">
							<button class="btn btn-default pull-right" ng-click="create(newStory)">Add story</button>
						</span>
					</div>
				</form>
			</div>

			<div ng-show="isAdding['deadline']" 
				class="new-story after-meeting deadline" >
				<form>
					<div class="input-group">
						<input id="deadlineEntry" type="text" class="form-control" ng-model="newDeadline.summary"/>
						<span class="input-group-btn">
							<button class="btn btn-default pull-right" ng-click="createDeadline(newDeadline)">Add milepost</button>
						</span>
					</div>
				</form>
			</div>
		</div>

		<div class="col-md-2 alt-mode" 
		ng-class="{alt: isManualAltMode || isAltMode}"
		ng-click="toggleAltMode()" title="inbox mode"><i class="glyphicon glyphicon-align-justify"></i></div>
	</div>
</div>

<div id="backlog" class="col-md-offset-2 clear">
	<div class="storyWrapper col-md-10" ng-repeat="story in stories"
		ng-hide="(isAltMode || isManualAltMode)
		&& (!story.isMoving 
		&& story.isAfterNextMeeting
		&& !story.isDeadline 
		&& !story.isNextMeeting)" data-story-id="{{story.id}}">
		<div class="backlog-mine pull-left">
			<i class="glyphicon glyphicon-arrow-right" ng-show="isStoryMine(story)"></i>
		</div>
		<div class="backlog-status col-md-1">
			<i class="done-status" ng-show="story.isDeadline && !story.isAfterNextMeeting" 
			ng-click="archive(story)" title="archive deadline"></i>
			<i class="done-status" ng-show="isStoryDone(story)" ng-click="archive(story)" 
			title="archive story"></i>
			<i class="active-status" ng-show="isStoryActive(story)"></i>
			
		</div>
		<div class="story col-md-9" ng-class="{ 
			selected: story.isSelected, 
			'not-selected': !story.isSelected,
			first: story.isFirstStory,
			deadline: story.isDeadline,
			'next-meeting': story.isNextMeeting,
			'after-meeting': story.isAfterNextMeeting
		}"
		ng-click="select(story)">
			<div ng-if="story.isSelected">
				<form>
					<div class="summary row">
						<div class="col-md-9">
							<input id="boxForStory{{story.id}}" class="form-control"
						type="text" ng-model="story.summary"/></div>
						<div class="col-md-3">
							<div class="deselect"><a ng-click="deselect(story)">Hide details</a></div>
						</div>
					</div>

					<div class="top-info" ng-hide="story.isNextMeeting || story.isDeadline">
						<div class="owner">Who's probably doing this?
							<!-- autocomplete="off"  -->
							<input type="text" ng-model="story.owner" typeahead-owners 
							class="typeahead form-control" />
						</div>
						<div class="status">What's up?
							<select ng-model="story.status" class="form-control">
								<option value="">(I don't know)</option>
								<option value="assigned">I've seen this task</option>
								<option value="active">I'm working on it</option>
								<option value="done">It's done</option>
							</select>
						</div>
					</div>

					<div class="description">
						<div>What should we know?
							<div class="created-by pull-right" ng-show="story.createdBy">
								story created by {{story.createdBy.name}}
							</div>
						</div>
						<div class="textarea-container">
							<textarea autosize ng-model="story.description" class="form-control" />
						</div>
					</div>

					<div class="commentArea" ng-if="!(story.isNextMeeting || story.isDeadline)">
						<div class="commentHeading">Questions or comments?</div>
						<div class="textarea-container">
							<textarea autosize placeholder="Add comment or link ..." ng-model="story.newComment" class="form-control"/>
						</div>

						<button class="saveBtn pull-right topSaveBtn btn btn-default" type="submit" ng-click="save(story)">Save</button>
						<div class="comment" ng-repeat="comment in story.comments | reverse" ng-class-odd="'odd'">
							<div class="text" append-linky ng-model="comment.text"><span class="name">{{comment.createdBy.name}}: </span></div>
						</div>
					</div>

					<div class="action-buttons">
						<button ng-hide="story.isNextMeeting" class="removeBtn" type="button" ng-click="remove(story)">Remove story</button>
						<button ng-show="story.isNextMeeting || story.isDeadline" class="saveBtn pull-right btn btn-default" type="submit" ng-click="save(story)">Save</button>
					</div>
				</form>
			</div>
			<span class="not-selected" ng-show="!story.isSelected" id="story-{{$index}}">{{story.summary}}</span>
		</div>

		<div 
			class="backlog-owner col-md-2" 
			ng-class="{'after': story.isAfterNextMeeting}"
			ng-click="select(story)">{{story.owner}}<span ng-show="isStoryNew(story)">?</span>
			<div 
				class="notify" 
				ng-class="{ notified: story.isOwnerNotified }"
				ng-show="story.owner && isStoryNew(story)"
				title="notify owner"><i class="glyphicon glyphicon-envelope" ng-click="notify(story)"></i>
				<span ng-show="story.isNotifying">o</span>
				<i ng-show="story.isOwnerNotified" title="ok!" class="glyphicon glyphicon-ok"></i>
			</div>

		</div>
	</div> <!-- ng-repeat -->
</div> <!-- backlog -->
